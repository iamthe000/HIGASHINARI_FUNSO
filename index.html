<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大豊中皇国：東成鎮圧戦</title>
    <style>
        :root {
            --primary-color: #002f58ff; /* 豊中ブルー */
            --hankyu-color: #800000; /* 阪急マルーン */
            --accent-color: #d4af37; /* 皇国の威光（金） */
            --danger-color: #ff3333;
            --text-color: #e0e0e0;
            --bg-color: #121212;
            --panel-bg: rgba(0, 20, 40, 0.95);
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: url('bg_capital.PNG');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        #game-container {
            width: 900px;
            max-width: 95%;
            background: var(--panel-bg);
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* 阪急発動時の特殊演出 */
        #game-container.hankyu-mode {
            border: 4px solid var(--hankyu-color);
            box-shadow: 0 0 50px var(--hankyu-color);
        }

        /* パラメータ表示 */
        #status-bar {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr; /* 4列に変更 */
            padding: 15px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), rgba(0,0,0,0.7));
            border-bottom: 3px solid var(--primary-color);
            font-weight: bold;
            font-size: 0.9em;
        }

        .stat-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            border-right: 1px solid #444;
        }
        .stat-box:last-child { border-right: none; }

        .stat-label { font-size: 0.8em; color: #888; }
        .stat-value { color: var(--accent-color); font-size: 1.4em; font-family: monospace; }
        
        /* 敵勢力表示 */
        #rebel-val { color: var(--danger-color); }

        .danger { color: var(--danger-color); animation: pulse 0.5s infinite; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* 画像エリア */
        #scene-image {
            width: 100%;
            height: 320px;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border-bottom: 1px solid #444;
            position: relative;
        }

        #scene-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.5s;
        }
        
        /* テキストエリア */
        #text-area {
            padding: 25px;
            min-height: 140px;
            font-size: 1.1em;
            line-height: 1.8;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid #333;
        }

        /* 選択肢エリア */
        #choices-area {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            background: rgba(0, 15, 30, 0.5);
        }

        .choice-btn {
            background: linear-gradient(90deg, #001f3f, #003366);
            color: #fff;
            border: 1px solid #4da6ff;
            padding: 16px 20px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1em;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .choice-btn:hover {
            background: linear-gradient(90deg, #003366, #005080);
            transform: translateX(4px);
            box-shadow: 0 0 15px rgba(77, 166, 255, 0.3);
        }

        /* 阪急ボタン */
        .hankyu-btn {
            background: linear-gradient(90deg, #5c0000, #800000) !important;
            border-color: #d4af37 !important;
        }

        .placeholder {
            color: #555;
            font-family: monospace;
            border: 2px dashed #444;
            padding: 20px;
            text-align: center;
            background: rgba(0,0,0,0.8);
        }

        /* アラートオーバーレイ */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 0, 0, 0.2);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 10;
        }
        
        #turn-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            padding: 5px 10px;
            border: 1px solid #666;
            font-size: 0.8em;
            color: #aaa;
            z-index: 5;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="overlay"></div>
    <div id="turn-indicator">Turn: <span id="turn-val">1</span></div>
    
    <div id="status-bar">
        <div class="stat-box">
            <span class="stat-label">国家予算</span>
            <span id="money-val" class="stat-value">60</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">皇国軍事力</span>
            <span id="army-val" class="stat-value">60</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">北摂支持率</span>
            <span id="support-val" class="stat-value">50</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">東成反乱度</span>
            <span id="rebel-val" class="stat-value">30</span>
        </div>
    </div>

    <div id="scene-image">
        <div class="placeholder">Loading...</div>
    </div>

    <div id="text-area">
        <p id="story-text">システム起動中...</p>
    </div>

    <div id="choices-area">
    </div>
</div>

<script>
    /* * ■ ゲーム設計思想：ループ型・リソース管理
     * 固定シナリオではなく、ランダムイベントの繰り返しにより「泥沼の紛争」を表現する。
     * ターンごとに反乱度は自然上昇する。
     */

    const initialGameState = {
        money: 60,      // やや低めでスタート
        army: 60,
        support: 50,
        rebelPower: 30, // 0で勝利、100で敗北
        turn: 1,
        isHankyuMode: false // 阪急確変モードフラグ
    };

    let gameState = { ...initialGameState };

    // ■ 新規画像推奨リスト
    // image: "event_danjiri.jpg" -> 改造だんじり戦車
    // image: "event_factory.jpg" -> 地下工場
    // image: "event_hankyu.jpg" -> 阪急電車（光り輝く）
    // image: "event_obachan.jpg" -> 大阪のおばちゃん部隊
    // image: "event_robot.jpg" -> 東成製巨大ロボ
    // image: "bg_ruins.jpg" -> 荒廃した街並み

    /* * ランダムイベントプール 
     * ここにイベントを追加することで無限にバリエーションが増える
     */
    const randomEvents = [
        {
            id: 'danjiri_attack',
            text: "「ソーリャ！ソーリャ！」<br>今里ロータリー付近で、東成軍の**装甲だんじり部隊**が突撃してきました。<br>凄まじい速度と質量です。",
            image: "event_danjiri.jpg",
            choices: [
                { text: "正面から砲撃で粉砕する (武力-15, 反乱度-15)", effect: (s) => { s.army -= 15; s.rebelPower -= 15; } },
                { text: "バリケードで回避し、燃料切れを待つ (予算-10, 反乱度-5)", effect: (s) => { s.money -= 10; s.rebelPower -= 5; } },
                { text: "逃げる (支持率-15, 反乱度+10)", effect: (s) => { s.support -= 15; s.rebelPower += 10; } }
            ]
        },
        {
            id: 'sewing_machine_gun',
            text: "東成の町工場が、工業用ミシンを改造した**高速連射ガトリング**を配備しました。<br>皇国軍のドローンが次々と撃ち落とされています。",
            image: "event_factory.jpg",
            choices: [
                { text: "対抗して最新兵器を投入 (予算-25, 反乱度-20)", effect: (s) => { s.money -= 25; s.rebelPower -= 20; } },
                { text: "歩兵による人海戦術で制圧 (武力-20, 支持率-5, 反乱度-15)", effect: (s) => { s.army -= 20; s.support -= 5; s.rebelPower -= 15; } },
                { text: "部品の供給ルートを断つ (予算-5, 武力-5)", effect: (s) => { s.money -= 5; s.army -= 5; /* 効果薄い */ } }
            ]
        },
        {
            id: 'obachan_spy',
            text: "「あんた、これ飴ちゃんあげるわ」<br>東成の**おばちゃん部隊**が検問を突破し、兵士に飴を配りながら情報を収集しています。<br>士気が骨抜きにされています！",
            image: "event_obachan.jpg",
            choices: [
                { text: "おばちゃんを強制排除する (支持率-30, 反乱度+10)", effect: (s) => { s.support -= 30; s.rebelPower += 10; } },
                { text: "高級和菓子で買収し、二重スパイにする (予算-30, 支持率+5)", effect: (s) => { s.money -= 30; s.support += 5; s.rebelPower -= 5; } },
                { text: "見て見ぬふりをする (武力-10)", effect: (s) => { s.army -= 10; s.rebelPower += 5; } }
            ]
        },
        {
            id: 'monozukuri_spirit',
            text: "東成区民の「ものづくり魂」が覚醒。<br>廃材を組み合わせた**巨大ロボット**が深江橋に出現！<br>豊中市民が恐怖で震えています。",
            image: "event_robot.jpg",
            choices: [
                { text: "マチカネ・ミサイル全弾発射 (武力-30, 反乱度-30)", effect: (s) => { s.army -= 30; s.rebelPower -= 30; } },
                { text: "プロパガンダ放送で「あれは特撮だ」と誤魔化す (支持率-10, 予算-5)", effect: (s) => { s.support -= 10; s.money -= 5; s.rebelPower += 10; } },
                { text: "鹵獲（ろかく）して解析を試みる (武力-20, 失敗リスク有)", effect: (s) => { 
                    if(Math.random() > 0.5) { s.army -= 10; s.money += 20; alert("鹵獲成功！技術を売却しました。"); } 
                    else { s.army -= 30; alert("解析失敗、部隊壊滅！"); } 
                }}
            ]
        },
        {
            id: 'media_war',
            text: "SNS上で「豊中の圧政」を訴える動画がバズっています。<br>国際社会（主に大阪市と堺市）からの風当たりが強くなっています。",
            image: "bg_war_room.JPG",
            choices: [
                { text: "情報統制を行い、アカウントを凍結 (予算-15, 支持率-5)", effect: (s) => { s.money -= 15; s.support -= 5; } },
                { text: "インフルエンサーを雇って反論させる (予算-20, 支持率+10)", effect: (s) => { s.money -= 20; s.support += 10; } },
                { text: "無視する (支持率-20)", effect: (s) => { s.support -= 20; } }
            ]
        },
        {
            id: 'shortage',
            text: "長期化する紛争により、前線の補給物資が不足しています。<br>兵士たちは空腹で、東成のお好み焼きの匂いに誘惑されています。",
            image: "bg_ruins.jpg",
            choices: [
                { text: "緊急増税を行い、物資を購入 (支持率-20, 予算+30, 武力+10)", effect: (s) => { s.support -= 20; s.money += 30; s.army += 10; } },
                { text: "略奪を許可する (支持率-40, 武力+20, 反乱度+20)", effect: (s) => { s.support -= 40; s.army += 20; s.rebelPower += 20; } },
                { text: "耐え忍ぶ (武力-20)", effect: (s) => { s.army -= 20; } }
            ]
        }
    ];

    /*
     * 固定イベント（OP/ED/特殊）
     */
    const fixedScenes = {
        'intro': {
            text: "西暦20XX年。<br>大豊中皇国の支配に対し、ものづくりの街・東成区が武装蜂起。「東成独立戦争」が勃発した。<br>彼らの技術力は侮れない。資源を管理し、反乱を鎮圧せよ。<br><br>※注意：いずれかのリソースが0になる、または反乱度が100に達すると敗北となる。",
            image: "bg_capital.PNG",
            choices: [
                { text: "作戦開始", next: 'game_loop_start', effect: () => {} }
            ]
        },
        // 阪急救済イベント
        'hankyu_rescue': {
            text: "<span style='color:#d4af37; font-weight:bold;'>【阪急の奇跡】</span><br>リソースが枯渇し、絶体絶命の危機に陥ったその時…<br>梅田方面から、黄金色の光を纏ったマルーンカラーの特急車両が突っ込んできた！<br>「阪急電鉄が皇国を支援する！」<br>莫大な支援物資と資金が投下されました。",
            image: "event_hankyu.jpg",
            choices: [
                { 
                    text: "ありがたや…ありがたや… (全回復)", 
                    next: 'game_loop_start', 
                    effect: (s) => { 
                        s.money = 100; s.army = 100; s.support = 100; s.rebelPower = 20; 
                        s.isHankyuMode = true;
                        document.getElementById('game-container').classList.add('hankyu-mode');
                    } 
                }
            ]
        },
        // エンディング
        'win': {
            text: "【鎮圧完了】<br>長きにわたる戦いの末、東成区の反乱軍は完全に沈黙した。<br>その卓越した技術力は再び大豊中皇国のために使われることになるだろう。<br>北摂の平和は守られたのだ。",
            image: "end_success.jpeg",
            choices: [{ text: "最初に戻る", next: 'intro', effect: (s) => resetGame(s) }]
        },
        'lose_resource': {
            text: "【国家崩壊】<br>戦争を継続するためのリソースが尽き果てました。<br>給与の支払われない兵士は去り、市民は暴徒化。<br>大豊中皇国は内部から崩れ去りました…。",
            image: "end_fail.jpeg",
            choices: [{ text: "最初に戻る", next: 'intro', effect: (s) => resetGame(s) }]
        },
        'lose_rebel': {
            text: "【東成独立】<br>反乱軍の勢いを止めることができませんでした。<br>彼らは独自兵器で豊中市内へ侵攻、皇国政府は亡命を余儀なくされました。<br>ここに「東成連邦」の樹立が宣言されます。",
            image: "event_revolt.JPG",
            choices: [{ text: "最初に戻る", next: 'intro', effect: (s) => resetGame(s) }]
        }
    };

    /*
     * ゲームロジック
     */

    function resetGame(s) {
        Object.assign(s, initialGameState);
        document.getElementById('game-container').classList.remove('hankyu-mode');
        document.getElementById('overlay').style.opacity = 0;
    }

    function checkGameOver() {
        // 敗北条件
        if (gameState.money <= 0 || gameState.army <= 0 || gameState.support <= 0) {
            return 'lose_resource';
        }
        if (gameState.rebelPower >= 100) {
            return 'lose_rebel';
        }
        // 勝利条件
        if (gameState.rebelPower <= 0) {
            return 'win';
        }
        return null;
    }

    // 阪急救済チャンス判定
    function checkHankyuSupport() {
        // いずれかのパラメータが15以下、かつ反乱度が高い場合
        const isCritical = (gameState.money <= 15 || gameState.army <= 15 || gameState.support <= 15);
        if (isCritical && !gameState.isHankyuMode) {
            // 10%の確率で発動
            if (Math.random() < 0.10) {
                return true;
            }
        }
        return false;
    }

    function updateScreen(sceneId) {
        // シーンID指定がなければループ処理へ
        if (sceneId === 'game_loop_start') {
            nextTurn();
            return;
        }

        // 状態更新
        const moneyEl = document.getElementById('money-val');
        const armyEl = document.getElementById('army-val');
        const supportEl = document.getElementById('support-val');
        const rebelEl = document.getElementById('rebel-val');
        const turnEl = document.getElementById('turn-val');

        moneyEl.textContent = gameState.money;
        armyEl.textContent = gameState.army;
        supportEl.textContent = gameState.support;
        rebelEl.textContent = gameState.rebelPower;
        turnEl.textContent = gameState.turn;

        // ピンチ演出
        moneyEl.className = gameState.money <= 20 ? 'stat-value danger' : 'stat-value';
        armyEl.className = gameState.army <= 20 ? 'stat-value danger' : 'stat-value';
        supportEl.className = gameState.support <= 20 ? 'stat-value danger' : 'stat-value';
        rebelEl.className = gameState.rebelPower >= 80 ? 'stat-value danger' : 'stat-value';

        // シーンデータの取得
        let sceneData;
        if (fixedScenes[sceneId]) {
            sceneData = fixedScenes[sceneId];
        } else {
            // ランダムイベントの場合
            sceneData = randomEvents.find(e => e.id === sceneId);
        }

        // 画像表示
        const imgContainer = document.getElementById('scene-image');
        imgContainer.innerHTML = '';
        if (sceneData.image) {
            const img = document.createElement('img');
            img.src = sceneData.image;
            img.onerror = function() {
                this.style.display = 'none';
                const div = document.createElement('div');
                div.className = 'placeholder';
                div.innerHTML = `イメージ信号途絶<br>${sceneData.image}`;
                imgContainer.appendChild(div);
            };
            imgContainer.appendChild(img);
        }

        // テキスト表示
        document.getElementById('story-text').innerHTML = sceneData.text;

        // 選択肢生成
        const choicesContainer = document.getElementById('choices-area');
        choicesContainer.innerHTML = '';

        sceneData.choices.forEach(choice => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            
            // 阪急イベントだけ特別クラス
            if (sceneId === 'hankyu_rescue') {
                btn.classList.add('hankyu-btn');
            }

            btn.innerHTML = choice.text;
            btn.onclick = () => {
                if (choice.effect) choice.effect(gameState);
                
                // 次のシーン決定ロジック
                if (choice.next) {
                    updateScreen(choice.next);
                } else {
                    // next指定がない場合はループ継続
                    updateScreen('game_loop_start');
                }
            };
            choicesContainer.appendChild(btn);
        });
    }

    function nextTurn() {
        // ゲームオーバー判定
        const result = checkGameOver();
        if (result) {
            updateScreen(result);
            return;
        }

        // 阪急チャンス判定
        if (checkHankyuSupport()) {
            updateScreen('hankyu_rescue');
            return;
        }

        // ターン経過処理
        gameState.turn++;
        // 反乱度は時間とともに自然増加する（難易度担保）
        gameState.rebelPower += 5;
        
        // ランダムにイベントを抽選
        const randomIndex = Math.floor(Math.random() * randomEvents.length);
        const nextEvent = randomEvents[randomIndex];

        updateScreen(nextEvent.id);
    }

    // 初期化実行
    updateScreen('intro');

</script>
</body>
</html>
